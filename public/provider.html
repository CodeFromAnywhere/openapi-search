<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAPI Provider Details</title>
    <meta name="description" content="Provider details and chat for OpenAPI specifications.">
    <meta property="og:title" content="OpenAPI Provider Details">
    <meta property="og:description" content="Provider details and chat for OpenAPI specifications.">
    <meta property="og:image" content="https://openapisearch.com/og-image.png">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-website-url.com">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
    <header class="bg-white shadow-md p-4">
        <div class="container mx-auto flex items-center justify-between">
            <a href="index.html" class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-arrow-left mr-2"></i>Back to Search
            </a>
            <h1 class="text-3xl font-bold">
                <a href="/index.html" class="text-blue-600 hover:text-blue-800">OpenAPI Search</a>
            </h1>
            <button id="shareBtn" class="bg-blue-400 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded">
                <i class="fab fa-twitter"></i> Share
            </button>
        </div>
    </header>

    <main class="container mx-auto flex-grow p-4">
        <div id="providerDetails" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 id="providerTitle" class="text-2xl font-bold mb-4"></h2>
            <div id="providerDescription" class="mb-4"></div>
            <div id="providerMetadata" class="text-sm text-gray-600"></div>
        </div>

        <div id="chatSection" class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-bold mb-4">Chat with OpenAPI</h3>
            <div id="chatMessages" class="mb-4 h-64 overflow-y-auto"></div>
            <div class="flex">
                <input type="text" id="userInput" class="flex-grow p-2 border rounded-l"
                    placeholder="Type your message...">
                <button id="sendBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r">
                    Send
                </button>
            </div>
        </div>
    </main>

    <footer class="bg-gray-200 p-4 mt-8">
        <div class="container mx-auto text-center text-gray-600">
            <p>&copy; 2023 OpenAPI Search. All rights reserved.</p>
        </div>
    </footer>

    <script>
        const data = {};

        // Function to share on Twitter
        const shareOnTwitter = () => {
            const text = encodeURIComponent("Check out this OpenAPI provider!");
            const url = encodeURIComponent(window.location.href);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        };

        document.getElementById('shareBtn').addEventListener('click', shareOnTwitter);

        // Function to display provider details
        const displayProviderDetails = () => {
            const titleElement = document.getElementById('providerTitle');
            const descriptionElement = document.getElementById('providerDescription');
            const metadataElement = document.getElementById('providerMetadata');

            titleElement.textContent = data.metadata.providerName || data.metadata.providerSlug || 'Unknown Provider';
            descriptionElement.innerHTML = marked.parse(data.metadata.info?.description || 'No description available');

            let metadataHtml = `
                <p>Provider Slug: ${data.metadata.providerSlug}</p>
                <p>Added: ${data.metadata.added || 'Unknown'}</p>
                <p>Updated: ${data.metadata.updated || 'Unknown'}</p>
                <p>OpenAPI Version: ${data.metadata.openapiVer}</p>
                <p>Category: ${data.metadata.category}</p>
            `;

            if (data.metadata.categories && data.metadata.categories.length > 0) {
                metadataHtml += `<p>Categories: ${data.metadata.categories.join(', ')}</p>`;
            }

            metadataElement.innerHTML = metadataHtml;
        };

        // Function to display chat messages
        const displayChatMessage = (role, content) => {
            const chatMessages = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            messageElement.className = `mb-2 ${role === 'user' ? 'text-right' : 'text-left'}`;
            messageElement.innerHTML = `
                <span class="inline-block bg-${role === 'user' ? 'blue' : 'gray'}-200 rounded px-2 py-1">
                    ${content}
                </span>
            `;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        };

        // Function to handle sending messages
        const sendMessage = async () => {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            if (message) {
                displayChatMessage('user', message);
                userInput.value = '';

                try {
                    const response = await axios.post('https://chat.actionschema.com/chat/completions', {
                        messages: [{ role: "system", content: `Please assist the user with this OpenAPI of ${data.metadata.providerSlug}:\n\n${data.metadata.stringSummary}` }, { role: "user", content: message }],
                        model: "gpt-4o-mini"
                    });

                    displayChatMessage('assistant', JSON.stringify(response.data));
                } catch (error) {
                    console.error('Error sending message:', error);
                    displayChatMessage('assistant', 'Sorry, there was an error processing your message.');
                }
            }
        };

        document.getElementById('sendBtn').addEventListener('click', sendMessage);
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Initialize the page
        const init = async () => {
            try {

                displayProviderDetails();

                // Display conversation starters
                data.conversationStarters.forEach(starter => {
                    const button = document.createElement('button');
                    button.textContent = starter;
                    button.className = 'bg-gray-200 hover:bg-gray-300 rounded px-2 py-1 mr-2 mb-2';
                    button.onclick = () => {
                        document.getElementById('userInput').value = starter;
                    };
                    document.getElementById('chatMessages').appendChild(button);
                });
            } catch (error) {
                console.error('Error fetching provider data:', error);
            }
        };

        init();
    </script>
</body>

</html>